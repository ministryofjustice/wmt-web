{% extends "includes/layout.html" %}

{% block content %}

<main id="content" role="main">

{% include "includes/breadcrumbs.html" %}

{% include "includes/validation-error-messages.html" %}

{% include "includes/title-subtitle.html" %}

{% include "includes/sub-nav.html" %}

<table class="non-javascript">
    <thead>
        <tr>
            <th scope="col"></th>
             {% for heading in capacity.headings %}
                <th scope="col">{{ heading | date("MMM DD, YYYY")}}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        <tr>
            <th scope="row">Capacity</th>
            {% for i in range(0, capacity.rows[0].values.length)%}
                <td> {{capacity.rows[0].values[i] | round}}% </td>
            {% endfor%}
        </tr>
        <tr>
            <th scope="row">Reductions</th>
            {% for i in range(0, capacity.rows[0].values.length)%}
                <td> {{capacity.rows[1].values[i] }}</td>
            {% endfor%}
        </tr>
    </tbody>

</table>

<div id="plotly-div-line" role="presentation"></div>

{% if organisationLevel === 'team' %}
<div id="team-capacity"></div>

  <h3 class="heading-medium">Capacity breakdown</h3>
  <table id="example" class="data-table dataTable">
    <thead>
      <tr>
        <th colspan="2" id="team">Offender manager</th>
        <th class="" colspan="14" id="breakdown">Capacity breakdown</th>
      </tr>
      <tr>
        <th id="name">Name</th>
        <th id="grade">Grade</th>
        <th id="capacity">Capacity(%)</th>
        <th id="cases">Cases</th>
        <th id="paroms"><abbr title="Parole assessment reports by the Offender Manager">PAROMs</abbr></th>
        <th id="fdrs"><abbr title="Fast delivery reports">FDRs</abbr></th>
        <th id="sdrs"><abbr title="Standard delivery reports">SDRs</abbr></th>
        <th id="arms"><abbr title="Active Risk Management System">ARMS</abbr></th>
        <th id="gs"><abbr title="Group supervision">GS</abbr></th>
        <th id="cms"><abbr title="Case management support">CMS</abbr></th>
      </tr>
    </thead>
    <tbody>
      {% for member in capacityBreakdown %}
      <tr>
        <td headers="name team"><a href="/offender-manager/{{ member.linkId }}">{{ member.name }}</a></td>
        <td headers="grade team">{{ member.grade }}</td>
        <td headers="capacity breakdown">{{ ((member.capacityPercentage * 10) | round) / 10 }}%</td>
        <td headers="cases breakdown">{{ member.totalCases }}</td>
        <td headers="paroms breakdown">-</td>
        <td headers="fdrs breakdown">-</td>
        <td headers="sdrs breakdown">-</td>
        <td headers="arms breakdown">-</td>
        <td headers="gs breakdown">-</td>
        <td headers="cms breakdown">{{ member.cmsPercentage }}%</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
  
</main>
{% endblock %}

{% block body_end %}
    <script type="text/javascript">
        var capacityTable = {{ capacity | dump | safe }}
    </script>
    <script src="/public/javascripts/plotly.js"></script>
    <script src="/public/javascripts/caseload-capacity.js"></script>
{% endblock %}
