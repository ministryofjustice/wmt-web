{% extends "includes/layout.html" %}

{% block content %}

<main id="content" role="main">

{% include "includes/breadcrumbs.html" %}

{% include "includes/validation-error-messages.html" %}

{% include "includes/title-subtitle.html" %}

{% include "includes/sub-nav.html" %}

{% include "includes/export.html" %}

{% if organisationLevel !== 'offender-manager' %}

  <h2 class="heading-large">Caseload totals</h2>

  {% if organisationLevel === 'team' %}
  {% for caseType in caseloadDetails %}
    {% if caseType.displayName !== 'Overall' %}
    <div id="caseloadSummary" class="grid-row">        
      <div class="column-one-third">
        <div id="{{ caseType.displayName.toLowerCase() }}Total" class="data">
          <span class="data-item bold-xlarge">{{ caseType.totalSummary }}</span>
          <span class="data-item bold-xsmall">{{ caseType.displayName }} cases</span>
        </div>
      </div>
    </div>
    {% endif %}
  {% endfor %}
  {% else %}
  {% for caseType in caseloadDetails %}
    {% if caseType.displayName === 'Overall' %}
    <div id="caseloadSummary">
      <table class="sln-table-caseload data-table">
        <thead>
          <tr>
            <th colspan="1" id="team">{{ childOrganisationLevelDisplayText }}</th>
            <th colspan="4" id="totals">Cases totals</th>
          </tr>
          <tr>
            <th id="name">Name</th>
            <th id="community" >Community Total</th>
            <th id="license">License Total</th>
            <th id="custody">Custody Total</th>
            <th id="total">Total</th>
          </tr>
        </thead>
        <tbody class="">
        {% for org in caseType.totalSummary %}
          <tr>
            {% if org.name === 'Total' %}
              <td headers="name team">{{ org.name }}</td>
            {% else %}
              <td headers="name team"><a href="/{{ childOrganisationLevel }}/{{ org.linkId }}">{{ org.name }}</a></td>
            {% endif %}
            <td headers="community total">{{ org.communityTotalCases }}</td>
            <td headers="license total">{{ org.licenseTotalCases }}</td>
            <td headers="custody total">{{ org.custodyTotalCases }}</td>
            <td headers="overall total">{{ org.totalCases }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
    {% endif %}
    {% endfor %}  
  {% endif %}

{% endif %}

{% if organisationLevel !== 'offender-manager'%}
<h2 class="heading-large">Caseload type breakdown</h2>
<div class="js-tabs">
  <ul class="js-tabs-links">
    {% for caseType in caseloadDetails %}
	    <li><a href="#{{ caseType.displayName.toLowerCase() }}" role="dynamic">{{caseType.displayName | title}}</a></li>
    {% endfor %}
  </ul>
  {% endif %}

  {% if organisationLevel === 'team' %}
  <div class="js-tabs-content">
  {% for caseType in caseloadDetails %}
    <div id="{{caseType.displayName.toLowerCase()}}">
      <h3 class="heading-medium">{{ caseType.displayName | title }} caseload by tier</h3>

      <table class="sln-table-caseload data-table">
        <thead>
          <tr>
            <th colspan="2" id="{{caseType.displayName}}_om">{{ childOrganisationLevelDisplayText }}</th>
            <th colspan="9" id="{{caseType.displayName}}_tiers">Case tiers</th>
          </tr>
          <tr>
            <th id="{{caseType.displayName}}_name">Name</th>
            <th id="{{caseType.displayName}}_grade">Grade</th>
            <th id="{{caseType.displayName}}_untiered">Untiered</th>
            <th id="{{caseType.displayName}}_d2">D2</th>
            <th id="{{caseType.displayName}}_d1">D1</th>
            <th id="{{caseType.displayName}}_c2">C2</th>
            <th id="{{caseType.displayName}}_c1">C1</th>
            <th id="{{caseType.displayName}}_b2">B2</th>
            <th id="{{caseType.displayName}}_b1">B1</th>
            <th id="{{caseType.displayName}}_a">A</th>
            <th id="{{caseType.displayName}}_total">Total</th>
          </tr>
        </thead>

        <tbody class="">
          {% for member in caseType.array %}
            <tr>
              <td headers="{{caseType.displayName}}_om {{caseType.displayName}}_name"><a href="/{{ childOrganisationLevel }}/{{ member.linkId }}">{{ member.name }}</a></td>
              <td headers="{{caseType.displayName}}_om {{caseType.displayName}}_grade">{{ member.gradeCode }}</td>
              <td headers="{{caseType.displayName}}_tiers {{caseType.displayName}}_untiered">{{ member.untiered }}</td>
              <td headers="{{caseType.displayName}}_tiers {{caseType.displayName}}_d2">{{ member.d2 }}</td>
              <td headers="{{caseType.displayName}}_tiers {{caseType.displayName}}_d1">{{ member.d1 }}</td>
              <td headers="{{caseType.displayName}}_tiers {{caseType.displayName}}_c2">{{ member.c2 }}</td>
              <td headers="{{caseType.displayName}}_tiers {{caseType.displayName}}_c1">{{ member.c1 }}</td>
              <td headers="{{caseType.displayName}}_tiers {{caseType.displayName}}_b2">{{ member.b2 }}</td>
              <td headers="{{caseType.displayName}}_tiers {{caseType.displayName}}_b1">{{ member.b1 }}</td>
              <td headers="{{caseType.displayName}}_tiers {{caseType.displayName}}_a">{{ member.a }}</td>
              <td headers="{{caseType.displayName}}_tiers {{caseType.displayName}}_total">{{ member.totalCases }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  {% endfor %}

  </div>

  {% elseif organisationLevel !== 'offender-manager' %}
  <div class="js-tabs-content">  
    {% for caseType in caseloadDetails %}

    <div id="{{caseType.displayName.toLowerCase()}}">
      <h3 class="heading-medium">{{ caseType.displayName | title }} caseload by tier</h3>
      <table class="sln-table-caseload data-table">
        <thead>
          <tr>
            <th colspan="2" id="{{caseType.displayName}}_om">{{ childOrganisationLevelDisplayText }}</th>
            <th colspan="9" id="{{caseType.displayName}}_tiers">Case tiers</th>
          </tr>
          <tr>
            <th id="{{caseType.displayName}}_name">Name</th>
            <th id="{{caseType.displayName}}_grade">Grade</th>
            <th id="{{caseType.displayName}}_untiered">Overall</th>            
            <th id="{{caseType.displayName}}_untiered">Untiered</th>
            <th id="{{caseType.displayName}}_d2">D2</th>
            <th id="{{caseType.displayName}}_d1">D1</th>
            <th id="{{caseType.displayName}}_c2">C2</th>
            <th id="{{caseType.displayName}}_c1">C1</th>
            <th id="{{caseType.displayName}}_b2">B2</th>
            <th id="{{caseType.displayName}}_b1">B1</th>
            <th id="{{caseType.displayName}}_a">A</th>
          </tr>
        </thead>
        <tbody class="">
          {% for member in caseType.array %}
            {% for i in range(0, member.grades.length) %}
            <tr>
              {% if i === 0 %}
              <td rowspan="{{ member.grades.length }}" headers="{{caseType.displayName}}_om {{caseType.displayName}}_name"><a href="/{{ childOrganisationLevel }}/{{ member.linkId }}">{{ member.name }}</a></td>
              {% endif %}
              <td headers="{{caseType.displayName}}_om {{caseType.displayName}}_grade">{{ member.grades[i].gradeCode }}</td>            
              <td headers="overall tiers" class="sln-to-round">{{ member.grades[i].totalCases }}</td>              
              <td headers="{{caseType.displayName}}_tiers {{caseType.displayName}}_untiered" class="sln-to-round">{{ member.grades[i].untiered }}</td>
              <td headers="{{caseType.displayName}}_tiers {{caseType.displayName}}_d2" class="sln-to-round">{{ member.grades[i].d2 }}</td>
              <td headers="{{caseType.displayName}}_tiers {{caseType.displayName}}_d1" class="sln-to-round">{{ member.grades[i].d1 }}</td>
              <td headers="{{caseType.displayName}}_tiers {{caseType.displayName}}_c2" class="sln-to-round">{{ member.grades[i].c2 }}</td>
              <td headers="{{caseType.displayName}}_tiers {{caseType.displayName}}_c1" class="sln-to-round">{{ member.grades[i].c1 }}</td>
              <td headers="{{caseType.displayName}}_tiers {{caseType.displayName}}_b2" class="sln-to-round">{{ member.grades[i].b2 }}</td>
              <td headers="{{caseType.displayName}}_tiers {{caseType.displayName}}_b1" class="sln-to-round">{{ member.grades[i].b1 }}</td>
              <td headers="{{caseType.displayName}}_tiers {{caseType.displayName}}_a" class="sln-to-round">{{ member.grades[i].a }}</td>
            </tr>
            {% endfor %}
          {% endfor %}
        </tbody>
      </table>
    </div>
{% endfor %}
  </div>


{% endif %}
</div>
</main>
{% endblock %}

{% block body_end %}
  <script src="/public/javascripts/vendor/jquery.js"></script>
  <script src="/public/javascripts/jquery.tabs.js"></script>
  <script src="/public/javascripts/round-to-one-decimal-place.js"></script>

<script>
  document.onload = roundValuesToOneDecimalPlace();

  $(function(){
      $('.js-tabs').tabs();
    });
</script>

{% endblock %}